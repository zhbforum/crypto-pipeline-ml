# crypto-pipeline-ml

End-to-end data & ML pipeline for Bitcoin:

* —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–∏–∫–∏ –∏–ª–∏ —Å–≤–µ—á–∏ —Å **Binance**,
* —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∏—Ö –Ω–∞ –¥–∏—Å–∫ –∏ –≤ **Kafka**,
* –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤ –¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ –≤ **S3** —Å –ø–æ–º–æ—â—å—é **Spark**,
* —Å—Ç—Ä–æ–∏—Ç **ARIMA-–ø—Ä–æ–≥–Ω–æ–∑—ã** –ø–æ —Ü–µ–Ω–µ BTC,
* –ø–∞—Ä—Å–∏—Ç –ø–æ—Å—Ç—ã POTUS –∏ —Å–æ–±—ã—Ç–∏—è –∏–∑ –µ–∫–æ–Ω–æ–º. –∫–∞–ª–µ–Ω–¥–∞—Ä—è Investing.com,
* –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–æ–≤ POTUS, –∏ –º–∞–∫—Ä–æ–∏–≤–µ–Ω—Ç–æ–≤
* —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ **AWS S3**
* –≥–æ—Ç–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ **Athena / Tableau**

---

## High-level architecture

```text
Binance API  ‚îÄ‚îÄ‚ñ∫ Async collector (Python, aiohttp)
              ‚îÇ
              ‚îú‚îÄ‚ñ∫ CSV on disk (optional)
              ‚îî‚îÄ‚ñ∫ Kafka topic
                    ‚îÇ
                    ‚ñº
           S3 raw layer: raw/topic=.../date=YYYY-MM-DD
                    ‚îÇ
                    ‚ñº
        Spark jobs (src/app/jobs/*.py)
        - s3_daily_aggregate: intraday ‚Üí daily OHLCV
        - s3_monthly_forecast: ARIMA forecasts
                    ‚îÇ
                    ‚ñº
           S3 gold/silver layer (daily + predictions)
                    ‚îÇ
                    ‚ñº
            Athena / Tableau dashboards
```

---

## Core components

### 1. Real-time Binance collector

**Module:** `src/app/scheduler.py` (entrypoint: `python -m app`)

* –†–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö:

  * `MODE=ticker` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ —Å–∏–º–≤–æ–ª–∞–º.
  * `MODE=kline` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —Å–≤–µ—á–∏ (`INTERVAL=1m, 3m, ...`).
* –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ **Binance REST API**.
* –ü–∏—à–µ—Ç –¥–∞–Ω–Ω—ã–µ:

  * –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π CSV (`OUT_DIR`),
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –≤ **Kafka** (`KAFKA_ENABLED`, `KAFKA_TOPIC`).
* –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª: —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä —É—Å–ø–µ—à–Ω–æ, —Å–∫–æ–ª—å–∫–æ —É–ø–∞–ª–∏, —Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ CSV –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Kafka.

---

### 2. Spark job: `s3_daily_aggregate.py`

**–§–∞–π–ª:** `src/app/jobs/s3_daily_aggregate.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–°–æ–±—Ä–∞—Ç—å –≤–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω—ã–µ OHLCV-—Å–æ–±—ã—Ç–∏—è –∏–∑ S3 (—Å—ã—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka) –∏ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –∏—Ö –≤ **–¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏** –≤ —á–∞—Å–æ–≤–æ–π –∑–æ–Ω–µ **Europe/Berlin**.

**–í—Ö–æ–¥:**

* **S3 raw**: `s3a://{S3_BUCKET}/{S3_PREFIX}/topic=.../date=YYYY-MM-DD`
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

  * payload –≤ JSON,
  * payload –≤ CSV (—á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `from_csv`).

**–í—ã—Ö–æ–¥:**

* **S3 gold daily OHLCV**:

  * –ø—É—Ç—å: `s3a://{S3_BUCKET}/{S3_PREFIX_GOLD}/ohlcv_daily`
  * —Ñ–æ—Ä–º–∞—Ç: `parquet`
  * –ø–∞—Ä—Ç–∏—Ü–∏–∏: `day`, `symbol`
  * –∫–æ–ª–æ–Ω–∫–∏: `day, symbol, open, high, low, close, volume, rows`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç job:**

* –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏ –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–æ–º—É –¥–Ω—é **–≤ –ë–µ—Ä–ª–∏–Ω–µ** (`Europe/Berlin`), —á—Ç–æ–±—ã –¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–∏.
* –ù–∞—Ö–æ–¥–∏—Ç:

  * `open` ‚Äî —Ü–µ–Ω–∞ –ø–µ—Ä–≤–æ–π —Å–¥–µ–ª–∫–∏ –∑–∞ –¥–µ–Ω—å,
  * `high` ‚Äî –º–∞–∫—Å–∏–º—É–º,
  * `low` ‚Äî –º–∏–Ω–∏–º—É–º,
  * `close` ‚Äî —Ü–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–¥–µ–ª–∫–∏ –∑–∞ –¥–µ–Ω—å,
  * `volume` ‚Äî —Å—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä—ë–º,
  * `rows` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ö–æ–¥–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.
* –ü–∏—à–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π gold-–¥–∞—Ç–∞—Å–µ—Ç —Å –∫–æ–∞–ª–µ—Å—Ü–µ–Ω—Ç–æ–º –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º (`COALESCE`).

---

### 3. Spark job: `s3_monthly_forecast.py`

**–§–∞–π–ª:** `src/app/jobs/s3_monthly_forecast.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
–ü–æ—Å—Ç—Ä–æ–∏—Ç—å **ARIMA-–ø—Ä–æ–≥–Ω–æ–∑—ã** –ø–æ –¥–Ω–µ–≤–Ω–æ–π —Ü–µ–Ω–µ BTC (–∏ –¥—Ä—É–≥–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –æ—à–∏–±–∫–∏) –≤ S3.

**–í—Ö–æ–¥:**

* **–ü—É—Ç—å —Å –¥–Ω–µ–≤–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**: `DAILY_AGG_PATH`
  (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `s3a://crypto-pipeline-ml/silver/kline=1d/symbol=BTCUSDT/`)
* –û–∂–∏–¥–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏: `iso_ts`, `symbol`, `close`.

**–í—ã—Ö–æ–¥:**

* **–ü—É—Ç—å —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏**: `DAILY_FORECAST_PATH`
  (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `s3a://crypto-pipeline-ml/silver/predictions_montly/`)
* –°—Ö–µ–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:

  * `symbol` ‚Äî —Ç–∏–∫–µ—Ä,
  * `ds` ‚Äî –¥–∞—Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞,
  * `y_hat_close` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–∞—è —Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è,
  * `created_at` ‚Äî timestamp –∑–∞–≥—Ä—É–∑–∫–∏,
  * –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω—ã `FORECAST_START_DS` –∏ `FORECAST_END_DS`):

    * `actual_close` ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π close,
    * `abs_error` ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –æ—à–∏–±–∫–∞,
    * `ape` ‚Äî absolute percentage error.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç job:**

* –ü—Ä–∏–≤–æ–¥–∏—Ç `iso_ts` –∫ –¥–∞—Ç–∞–º (`ds`) –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –ø–æ —Å–∏–º–≤–æ–ª—É –∏ –¥–Ω—é.
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞:

  * —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—é,
  * –æ–±—É—á–∞–µ—Ç **ARIMA-–º–æ–¥–µ–ª—å** (`pmdarima.auto_arima`) –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–º `close`,
  * —Å—Ç—Ä–æ–∏—Ç –ø—Ä–æ–≥–Ω–æ–∑:

    * –ª–∏–±–æ –Ω–∞ **—Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å** (–µ—Å–ª–∏ –Ω–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω–∞),
    * –ª–∏–±–æ –Ω–∞ **–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–µ—Ä–∏–æ–¥–µ** [`FORECAST_START_DS`, `FORECAST_END_DS`], –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—é –¥–æ —Ü–µ–ª–µ–≤–æ–π –¥–∞—Ç—ã.
* –ï—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –≤—ã—á–∏—Å–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ø–∏—à–µ—Ç –∏—Ö –≤–º–µ—Å—Ç–µ —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏ –≤ S3, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä—É—è –ø–æ `ds` –∏ `symbol`.

---

### 4. TruthSocial + FinBERT sentiment (experimental)

**–ú–æ–¥—É–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** `src/app/parser_settings/constants.py`

–≠—Ç–æ—Ç –∫—É—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∏ —Ä–∞–∑–º–µ—Ç–∫—É —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–æ–≤ **Donald Trump (TruthSocial)**:

* —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –ø–æ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–º –∏ –∫—Ä–∏–ø—Ç–æ-–∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (`ECONOMIC_CRYPTO_KEYWORDS`, `ECONOMIC_MACRO_KEYWORDS`);
* –∑–∞–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç **2025-01-20** (`START_DATE_UTC`);
* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É—Ç–∏ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É JSONL —Å –ø–æ—Å—Ç–∞–º–∏ (`TRUTH_JSONL_REL_PATH`);
* –∑–∞–ø—É—Å–∫ **FinBERT** (`FINBERT_REL_DIR`, `FINBERT_MAX_LEN`, `FINBERT_BATCH_SIZE` –∏ —Ç. –¥.) –¥–ª—è —Ä–∞—Å—Å—á—ë—Ç–∞:

  * –∫–æ–Ω—Ç–∏–Ω—É—É–º–∞ —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç–∞ (–æ—Ç —Å–∏–ª—å–Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ —Å–∏–ª—å–Ω–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ),
  * –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–ª–∏–∑–∫–æ –∫ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É (`NEUTRAL_LOWER`, `NEUTRAL_UPPER`).
* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ **S3** –ø–æ–¥ –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `S3_EVENTS_PATH = "event/source=truthsocial/user=realDonaldTrump"`.

> –û—Ç–¥–µ–ª—å–Ω—ã–π Spark-job –¥–ª—è —ç—Ç–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ `src/app/jobs` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —á—Ç–µ–Ω–∏—è TruthSocial-–¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø—É—Å–∫–∞ FinBERT –∏ –∑–∞–ø–∏—Å–∏ —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ S3.

---

### 5. Twitter/X tweets pipeline (POTUS tweets)

**–ü–∞–ø–∫–∞:** `src/app/tweets/`

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤/–¥–∂–æ–± –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É —Ç–∞ –∞–Ω–∞–ª—ñ–∑ —Ç–≤—ñ—Ç—ñ–≤ (Twitter/X)** —è–∫ –æ–∫—Ä–µ–º–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞ ‚Äú—ñ–Ω—Ñ–æ-—Ñ–æ–Ω—É‚Äù –¥–ª—è —Ä–∏–Ω–∫—É:

* **—ñ–Ω–∂–µ—Å—Ç/—ñ–º–ø–æ—Ä—Ç** —Ç–≤—ñ—Ç—ñ–≤ —ñ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç—É (–∞—Ä—Ö—ñ–≤/–µ–∫—Å–ø–æ—Ä—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ JSON/CSV) —É —î–¥–∏–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–¥—ñ–π;
* **–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è** –ø–æ–ª—ñ–≤ (—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –ø–æ—Å—Ç–∞, —á–∞—Å –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó, —Ç–µ–∫—Å—Ç, –∞–≤—Ç–æ—Ä/–¥–∂–µ—Ä–µ–ª–æ, –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –º–µ—Ç—Ä–∏–∫–∏ –≤–∑–∞—î–º–æ–¥—ñ—ó —è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω—ñ);
* **—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è** —Ç–≤—ñ—Ç—ñ–≤ –∑–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏–º–∏/–∫—Ä–∏–ø—Ç–æ-–∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ (—â–æ–± –≤—ñ–¥—Å—ñ–∫—Ç–∏ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–π —à—É–º);
* **sentiment scoring** (—Ç–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å) –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–≤—ñ—Ç–∞ (—â–æ–± –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ Athena/Tableau —è–∫ –º–∞—Ä–∫–µ—Ä–∏ –ø–æ–¥—ñ–π);
* **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É S3** –≤ ‚Äúevents‚Äù —à–∞—Ä—ñ –∑ –ø–∞—Ä—Ç–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è–º (–ø–µ—Ä–µ–≤–∞–∂–Ω–æ –∑–∞ –¥–∞—Ç–æ—é/–¥–∂–µ—Ä–µ–ª–æ–º), —â–æ–± –¥–∞–ª—ñ —Ä–æ–±–∏—Ç–∏ –¥–∂–æ—ó–Ω–∏ –∑ BTC-–¥–∞–Ω–∏–º–∏ —Ç–∞ –±—É–¥—É–≤–∞—Ç–∏ –¥–∞—à–±–æ—Ä–¥–∏.

> –£ –ø—ñ–¥—Å—É–º–∫—É, `tweets`-–ø–∞–π–ø–ª–∞–π–Ω –¥–∞—î –∑—Ä—É—á–Ω–∏–π ‚Äúevent layer‚Äù –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —á–∞—Å–æ–≤–∏—Ö –º—ñ—Ç–æ–∫ —Ç–≤—ñ—Ç—ñ–≤ —ñ–∑ —Ä—É—Ö–æ–º —Ü—ñ–Ω–∏/–æ–±—Å—è–≥—É BTC —É –≤—ñ–∫–Ω–∞—Ö ‚Äú–¥–æ/–ø—ñ—Å–ª—è‚Äù —Ç–∞ –¥–ª—è –ø–æ—à—É–∫—É –Ω–∞–π–±—ñ–ª—å—à –≤–ø–ª–∏–≤–æ–≤–∏—Ö —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.

---

## Configuration

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. `src/app/constants.py` –∏ `src/app/jobs`):

### Collector (real-time)

* `MODE` ‚Äî `"ticker"` –∏–ª–∏ `"kline"` (—Ä–µ–∂–∏–º —Å–±–æ—Ä–∞).
* `INTERVAL` ‚Äî —Ç–∞–π–º—Ñ—Ä–µ–π–º —Å–≤–µ—á–µ–π (–≤ —Ä–µ–∂–∏–º–µ `kline`):
  `1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 12h, 1d`.
* `PAIRS` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ Binance (–Ω–∞–ø—Ä–∏–º–µ—Ä, `["BTCUSDT", "ETHUSDT"]`).
* `EVERY_SEC` ‚Äî –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏ –≤ —Ä–µ–∂–∏–º–µ `ticker` (—Å–µ–∫—É–Ω–¥—ã).
* `OUT_DIR` ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è CSV (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
* `CONCURRENCY` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Binance.
* `BINANCE_BASE` ‚Äî –±–∞–∑–æ–≤—ã–π URL –¥–ª—è Binance API.
* Kafka:

  * `SINK` ‚Äî —Ä–µ–∂–∏–º sink (`csv+kafka` –≤–∫–ª—é—á–∞–µ—Ç Kafka –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
  * `KAFKA_ENABLED` ‚Äî —è–≤–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ Kafka.
  * `KAFKA_TOPIC` ‚Äî –∏–º—è Kafka-—Ç–æ–ø–∏–∫–∞.
  * `CLIENT_PROPERTIES_PATH` ‚Äî –ø—É—Ç—å –∫ `client.properties` (SASL / –±—Ä–æ–∫–µ—Ä—ã –∏ —Ç. –¥.).

### Spark / S3 jobs

–û–±—â–µ–µ:

* `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`, `AWS_DEFAULT_REGION` ‚Äî AWS-—É—á—ë—Ç–∫–∞.
* `SPARK_PACKAGES` ‚Äî —Å–ø–∏—Å–æ–∫ Spark-–ø–∞–∫–µ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ—Ç `hadoop-aws` –∏ `aws-java-sdk-bundle`).

**`s3_daily_aggregate.py`**

* `S3_BUCKET` ‚Äî –∏–º—è S3-–±–∞–∫–µ—Ç–∞ (`crypto-pipeline-ml`).
* `S3_PREFIX` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è raw-—Å–ª–æ—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `raw`).
* `S3_PREFIX_GOLD` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è gold-—Å–ª–æ—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `gold`).
* `KAFKA_TOPIC` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–ø–∏–∫ (–∏–ª–∏ `--all-topics` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –≤—Å–µ–º).
* `DATE` ‚Äî –¥–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (`YYYY-MM-DD`), –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω —á–µ—Ä–µ–∑ `--date`.
* `WRITE_FORMAT` ‚Äî —Ñ–æ—Ä–º–∞—Ç raw-–¥–∞–Ω–Ω—ã—Ö (`parquet` –∏–ª–∏ –¥—Ä—É–≥–æ–π).
* `COALESCE` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

**`s3_monthly_forecast.py`**

* `DAILY_AGG_PATH` ‚Äî –ø—É—Ç—å –∫ –¥–Ω–µ–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º (–∏–Ω–ø—É—Ç).
* `DAILY_FORECAST_PATH` ‚Äî –ø—É—Ç—å, –∫—É–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã (–∞—É—Ç–ø—É—Ç).
* `FORECAST_START_DS`, `FORECAST_END_DS` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –¥–ª—è backtest/–æ—Ü–µ–Ω–∫–∏ –º–æ–¥–µ–ª–∏.

---

## Running the jobs (quick examples)

> –ù–∏–∂–µ ‚Äî –æ–±—â–∞—è –∏–¥–µ—è. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–ª–∞–≥–∏/–ø—É—Ç–∏ –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–≤–æ—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

### Collector

```bash
# –ü—Ä–∏–º–µ—Ä: —Å–±–æ—Ä –º–∏–Ω—É—Ç–Ω—ã—Ö —Å–≤–µ—á–µ–π BTCUSDT –∏ ETHUSDT —Å –∑–∞–ø–∏—Å—å—é –≤ CSV –∏ Kafka
export MODE=kline
export INTERVAL=1m
export PAIRS='["BTCUSDT","ETHUSDT"]'
export OUT_DIR=data
export SINK=csv+kafka
export KAFKA_TOPIC=topic_0

PYTHONPATH=src python -m app
```

### s3_daily_aggregate

```bash
# –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å raw-–¥–∞–Ω–Ω—ã–µ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å –≤ –¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏
export S3_BUCKET=crypto-pipeline-ml
export S3_PREFIX=raw
export S3_PREFIX_GOLD=gold
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...

spark-submit \
  src/app/jobs/s3_daily_aggregate.py \
  --env-file src/app/jobs/.env \
  --date 2025-11-20
```

### s3_monthly_forecast

```bash
# –ü–æ—Å—Ç—Ä–æ–∏—Ç—å ARIMA-–ø—Ä–æ–≥–Ω–æ–∑—ã –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
export AWS_ACCESS_KEY_ID=...
export AWS_SECRET_ACCESS_KEY=...
export DAILY_AGG_PATH='s3a://crypto-pipeline-ml/silver/kline=1d/symbol=BTCUSDT/'
export DAILY_FORECAST_PATH='s3a://crypto-pipeline-ml/silver/predictions_montly/'
export FORECAST_START_DS='2025-11-01'
export FORECAST_END_DS='2025-11-30'

spark-submit src/app/jobs/s3_monthly_forecast.py
```

---

## Roadmap

* ‚úÖ –†–µ–∞–ª-—Ç–∞–π–º —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö Binance ‚Üí CSV + Kafka
* ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü–∏—è intraday ‚Üí –¥–Ω–µ–≤–Ω—ã–µ —Å–≤–µ—á–∏ (S3 gold)
* ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ ARIMA-–ø—Ä–æ–≥–Ω–æ–∑—ã –¥–ª—è BTC (–∏ –¥—Ä—É–≥–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤)
* ‚úÖ TruthSocial + FinBERT sentiment pipeline –≤ S3 events
* ‚úÖ –ú–∞–∫—Ä–æ-–∏–≤–µ–Ω—Ç—ã + BTC-—Ñ–∏—á–∏ –¥–ª—è Athena / Tableau
* üöß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (Airflow / Prefect / GitHub Actions) –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –¥–∂–æ–± –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

---